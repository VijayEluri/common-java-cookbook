<html xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>9.4.2.&nbsp;Solution</title>
      <link rel="stylesheet" href="../css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="book.html" title="Jakarta Commons Cookbook">
      <link rel="up" href="jakartackbk-CHP-9-SECT-4.html" title="9.4.&nbsp;Externalizing Logic with an Expression Language">
      <link rel="prev" href="jakartackbk-CHP-9-SECT-4.html" title="9.4.&nbsp;Externalizing Logic with an Expression Language">
      <link rel="next" href="jakartackbk-CHP-9-SECT-4.3.html" title="9.4.3.&nbsp;Discussion">
   </head>
   <body>
      <div id="frame">
         <div id="forbg">
            <div id="user-header">
               <div id="logo"><a href="http://www.discursive.com" title="$"><img src="../images/discursive-logo.png" border="0"></a></div>
               <div id="right-header">
                  <h2>Common Java Cookbook</h2>
                  <h4>Edition: 0.1-SNAPSHOT</h4>
               </div>
               <div style="clear:both;"></div>
               <div id="left-sidebar"></div>
            </div>
            <div class="navheader">
               <table width="100%" summary="Navigation header">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-9-SECT-4.html">9.4.&nbsp;Externalizing Logic with an Expression Language</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">
                           												TOC
                                                                       </a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-9-SECT-4.3.html">9.4.3.&nbsp;Discussion</a></td>
                  </tr>
               </table>
            </div>
            <div class="sect2" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title"><a name="jakartackbk-CHP-9-SECT-4.2"></a>9.4.2.&nbsp;Solution
                        </h3>
                        <div class="section-icon"></div>
                     </div>
                  </div>
               </div>
               <p>Use an external properties file to store <a class="indexterm" name="jakartackbk-CHP-9-ITERM-2962"></a>expressions used in an application.
                  For this recipe, imagine yourself creating a system to sort
                  <code class="literal">Ball</code> objects based on a set of arbitrary criteria.
                  Instead of hard-coding criteria in a series of Java
                  <code class="literal">if</code>-<code class="literal">else</code> clauses, create a
                  framework with loads sorting criteria from a properties file
                  containing <code class="literal">boolean</code> JEXL expressions. For instance,
                  the first line in this properties file would be:
               </p><a name="I_9_tt360"></a><pre class="programlisting">Hvy-Green-Basket = ball.color == 'Green' &amp;&amp; (ball.weight &gt; 1000)</pre><p>This translates to "If the ball's
                  color is Green and the weight is over 1000, put this ball into the
                  Heavy Green basket." The name of each property is
                  the name of the basket into which a <code class="literal">Ball</code> matching
                  the criteria is placed. The contents of the criteria file are:
               </p><a name="I_9_tt361"></a><pre class="programlisting">Hvy-Green-Basket = ball.color == 'Green' &amp;&amp; (ball.weight &gt; 1000)
Sm-Yellow-bin = ball.color == 'Yellow' &amp;&amp; (ball.weight &lt; 100)
Transparent-Bin = ball.isTransparent( )
Lrg-Yellow-Basket = ball.color == 'Yellow' &amp;&amp;(ball.weight &gt;= 100)
Misc-Bin = true</pre><p>Each criterion is applied to each <code class="literal">Ball</code> object in
                  the order it appears in the criteria file. The heavy green sorting
                  criteria is applied first, and each criterion is evaluated until the
                  last criterion is reached. The last criteria always evaluates to
                  <code class="literal">true</code>&#8212;similar to a
                  <code class="literal">switch</code>-<code class="literal">case</code> control statement,
                  the "Misc-bin" is the default. The
                  following code reads this criteria file and evaluates each JEXL
                  expression in order to sort a collection of <code class="literal">Ball</code>
                  objects:
               </p><a name="I_9_tt362"></a><pre class="programlisting">import org.apache.commons.jexl.Expression;
import org.apache.commons.jexl.ExpressionFactory;
import org.apache.commons.jexl.JexlContext;
import org.apache.commons.jexl.JexlHelper;

// Load in our criteria properties
Properties criteria = new Properties( );
criteria.load( getClass( ).getResourceAsStream("criteria.txt") );

Set binNames = criteria.getKeys( );

// Load our ball objects into a List
List balls = getBalls( );
Iterator ballsIter = balls.iterator( );
while( ballsIter.hasNext( ) ) {
    Ball ball = (Ball) ballsIter.next( );

    // Iterate through every rule, until you find a match...
    Iterator binIter = binName.iterator( );
    while( ruleIter.hasNext( ) ) {
        
        // Get the name of the basket
        String basket = (String) binIter.next( );

        // Get the expression corresponding to this bin.
        String expr = conditions.get( bin );
        Expression e = ExpressionFactory.createExpression( expr );          

        // Populate the context with the current Ball object
        JexlContext jc = JexlHelper.createContext( );
        jc.getVars( ).put("ball", ball);
        
        // Evaluate the Expression.
        Boolean result = (Boolean) e.evaluate(jc);
        
        // If the expression evaluated to true, add this Ball to the bin.
        if( result.booleanValue( ) == true ) {
            sendBall( ball, basket );
        }
    }
}</pre><p>The result of the <code class="literal">Expression</code> evaluation is a
                  <code class="literal">Boolean</code>
                                 <a class="indexterm" name="jakartackbk-CHP-9-ITERM-2963"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-9-ITERM-2964"></a>
                  value, and, if the <code class="literal">Boolean</code> result is
                  <code class="literal">true</code>, the matching <code class="literal">Ball</code> is sent
                  to the specified basket.
               </p>
            </div>
            <div class="navfooter">
               <hr>
               <table width="100%" summary="Navigation footer">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-9-SECT-4.html">Prev</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-9-SECT-4.3.html">Next</a></td>
                  </tr>
                  <tr>
                     <td width="40%" align="left" valign="top">9.4.&nbsp;Externalizing Logic with an Expression Language&nbsp;</td>
                     <td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.sonatype.com/" title="Discursive: Discursive">Sponsored by Discursive
                                                                      </a></span></td>
                     <td width="40%" align="right" valign="top">&nbsp;9.4.3.&nbsp;Discussion</td>
                  </tr>
               </table>
            </div><br><center>
                             Copyright 2009. Discursive. All Rights Reserved.
                           
            </center><script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1693297-1");
pageTracker._initData();
pageTracker._setDomainName(".sonatype.com");
pageTracker._trackPageview();
</script><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
  _lf_cid = "LF_5208d25a";
_lf_remora();
</script></div>
      </div>
   </body>
</html>