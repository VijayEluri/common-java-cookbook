<html xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>6.2.2.&nbsp;Solution</title>
      <link rel="stylesheet" href="../css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="book.html" title="Jakarta Commons Cookbook">
      <link rel="up" href="jakartackbk-CHP-6-SECT-2.html" title="6.2.&nbsp;Turning XML Documents into Objects">
      <link rel="prev" href="jakartackbk-CHP-6-SECT-2.html" title="6.2.&nbsp;Turning XML Documents into Objects">
      <link rel="next" href="jakartackbk-CHP-6-SECT-2.3.html" title="6.2.3.&nbsp;Discussion">
   </head>
   <body>
      <div id="frame">
         <div id="forbg">
            <div id="user-header">
               <div id="logo"><a href="http://www.discursive.com" title="$"><img src="../images/discursive-logo.png" border="0"></a></div>
               <div id="right-header">
                  <h2>Common Java Cookbook</h2>
                  <h4>Edition: 0.1-SNAPSHOT</h4>
               </div>
               <div style="clear:both;"></div>
               <div id="left-sidebar"></div>
            </div>
            <div class="navheader">
               <table width="100%" summary="Navigation header">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-6-SECT-2.html">6.2.&nbsp;Turning XML Documents into Objects</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">
                           												TOC
                                                                       </a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-6-SECT-2.3.html">6.2.3.&nbsp;Discussion</a></td>
                  </tr>
               </table>
            </div>
            <div class="sect2" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title"><a name="jakartackbk-CHP-6-SECT-2.2"></a>6.2.2.&nbsp;Solution
                        </h3>
                        <div class="section-icon"></div>
                     </div>
                  </div>
               </div>
               <p>Use the Commons Digester to transform an XML document into an object
                  graph. The Digester allows you to map an XML document structure to an
                  object model in an external XML file containing a set of rules
                  telling the Digester what to do when specific elements are
                  encountered. In this recipe, the following XML document containing a
                  description of a play will be parsed into an object graph:
               </p><a name="I_6_tt259"></a><pre class="programlisting">&lt;?xml version="1.0"?&gt;

&lt;plays&gt;
  &lt;play genre="tragedy" year="1603" language="english"&gt;
    &lt;name&gt;Hamlet&lt;/name&gt;
    &lt;author&gt;William Shakespeare&lt;/author&gt;
    &lt;summary&gt;
      Prince of Denmark freaks out, talks to ghost, gets into a
      crazy nihilistic funk, and dies in a duel.
    &lt;/summary&gt;
    &lt;characters&gt;
      &lt;character protagonist="false"&gt;
        &lt;name&gt;Claudius&lt;/name&gt;
        &lt;description&gt;King of Denmark&lt;/description&gt;
      &lt;/character&gt;
      &lt;character protagonist="true"&gt;
        &lt;name&gt;Hamlet&lt;/name&gt;
        &lt;descr&gt;
          Son to the late, and nephew of the present king
        &lt;/descr&gt;
      &lt;/character&gt;
      &lt;character protagonist="false"&gt;
        &lt;name&gt;Horatio&lt;/name&gt;
        &lt;descr&gt;
          friend to Hamlet
        &lt;/descr&gt;
      &lt;/character&gt;
    &lt;/characters&gt;
  &lt;/play&gt;
&lt;/plays&gt;</pre><p>This XML document contains a list of <code class="literal">play</code> elements
                  describing plays by William Shakespeare. One play element describes
                  "Hamlet"; it includes a
                  <code class="literal">name</code>, <code class="literal">author</code>, and
                  <code class="literal">summary</code> element as well as a
                  <code class="literal">characters</code> element containing
                  <code class="literal">character</code> elements describing characters in the
                  play. After parsing a document with Digester, each
                  <code class="literal">play</code> element will be represented by a
                  <code class="literal">Play</code> object with a set of properties and a
                  <code class="literal">List</code> of <code class="literal">Character</code> objects:
               </p><a name="I_6_tt260"></a><pre class="programlisting">public class Play {
    private String genre;
    private String year;
    private String language;
    private String name;
    private String author;
    private String summary;
    private List characters = new ArrayList( );

    // accessors omitted for brevity

    // Add method to support adding elements to characters.
    public void addCharacter(Character character) {
        characters.add( character );
    }
}

public class Character {
    private String name;
    private String description;
    private boolean protagonist;

    // accessors omitted for brevity
}</pre><p>The Digester maps XML to objects using a set of rules, which can be
                  defined either in an XML file, or they can be constructed
                  programmatically by creating instances of <code class="literal">Rule</code> and
                  adding them to an instance of <code class="literal">Digester</code>. This
                  recipe uses an XML file to create a set of rules that tell the
                  Digester how to translate an XML document to a
                  <code class="literal">List</code> of <code class="literal">Play</code> objects:
               </p><a name="I_6_tt261"></a><pre class="programlisting">&lt;?xml version="1.0"?&gt;

&lt;digester-rules&gt;
  &lt;pattern value="plays/play"&gt;
    &lt;object-create-rule classname="xml.digester.Play"/&gt;
    &lt;set-next-rule methodname="add" paramtype="java.lang.Object"/&gt;
    &lt;set-properties-rule/&gt;
    &lt;bean-property-setter-rule pattern="name"/&gt;
    &lt;bean-property-setter-rule pattern="summary"/&gt;
    &lt;bean-property-setter-rule pattern="author"/&gt;
    
    &lt;!-- Nested Pattern for Characters --&gt;
    &lt;pattern value="characters/character"&gt;
      &lt;object-create-rule classname="xml.digester.Character"/&gt;
      &lt;set-next-rule methodname="addCharacter" 
                     paramtype="xml.digester.Character"/&gt;
      &lt;set-properties-rule/&gt;
      &lt;bean-property-setter-rule pattern="name"/&gt;
      &lt;bean-property-setter-rule pattern="descr" 
                                 propertyname="description"/&gt;
    &lt;/pattern&gt;
  
  &lt;/pattern&gt;
&lt;/digester-rules&gt;</pre><p>This mapping document (or rule sets) can be explained in very
                  straightforward language. It is telling Digester how to deal with the
                  document, "When you see an element matching the
                  pattern <code class="filename">plays/play</code>, create an instance of
                  <code class="literal">xml.digester.Play</code>, set some properties, and push
                  it on to a <code class="literal">Stack</code>
                  (<code class="literal">object-create-rule</code>). If you encounter an element
                  within a <code class="literal">play</code> element that matches
                  <code class="filename">characters/character</code>, create an instance of
                  <code class="literal">xml.digester.Character</code>, set some properties, and
                  add it to the <code class="literal">Play</code> object." The
                  following code creates an instance of <code class="literal">Digester</code>
                  from the XML rule sets shown previously, producing a <code class="literal">plays
                     List</code>, which contains one <code class="literal">Play</code> object:
               </p><a name="I_6_tt262"></a><pre class="programlisting">import org.apache.commons.digester.Digester;
import org.apache.commons.digester.xmlrules.DigesterLoader;

List plays = new ArrayList( );

// Create an instance of the Digester from the XML rule set
URL rules = getClass( ).getResource("./play-rules.xml");
Digester digester = DigesterLoader.createDigester(rules);

// Push a reference to the plays List on to the Stack
digester.push(plays);

// Parse the XML document
InputStream input = getClass( ).getResourceAsStream("./plays.xml");
Object root = digester.parse(input);

// The XML document contained one play "Hamlet"
Play hamlet = (Play) plays.get(0);
List characters = (List) hamlet.getCharacters( );</pre></div>
            <div class="navfooter">
               <hr>
               <table width="100%" summary="Navigation footer">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-6-SECT-2.html">Prev</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-6-SECT-2.3.html">Next</a></td>
                  </tr>
                  <tr>
                     <td width="40%" align="left" valign="top">6.2.&nbsp;Turning XML Documents into Objects&nbsp;</td>
                     <td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.sonatype.com/" title="Discursive: Discursive">Sponsored by Discursive
                                                                      </a></span></td>
                     <td width="40%" align="right" valign="top">&nbsp;6.2.3.&nbsp;Discussion</td>
                  </tr>
               </table>
            </div><br><center>
                             Copyright 2009. Discursive. All Rights Reserved.
                           
            </center><script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1693297-1");
pageTracker._initData();
pageTracker._setDomainName(".sonatype.com");
pageTracker._trackPageview();
</script><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
  _lf_cid = "LF_5208d25a";
_lf_remora();
</script></div>
      </div>
   </body>
</html>