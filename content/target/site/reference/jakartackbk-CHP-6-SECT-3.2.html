<html xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>6.3.2.&nbsp;Solution</title>
      <link rel="stylesheet" href="../css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="book.html" title="Jakarta Commons Cookbook">
      <link rel="up" href="jakartackbk-CHP-6-SECT-3.html" title="6.3.&nbsp;Namespace-Aware Parsing">
      <link rel="prev" href="jakartackbk-CHP-6-SECT-3.html" title="6.3.&nbsp;Namespace-Aware Parsing">
      <link rel="next" href="jakartackbk-CHP-6-SECT-3.3.html" title="6.3.3.&nbsp;Discussion">
   </head>
   <body>
      <div id="frame">
         <div id="forbg">
            <div id="user-header">
               <div id="logo"><a href="http://www.discursive.com" title="$"><img src="../images/discursive-logo.png" border="0"></a></div>
               <div id="right-header">
                  <h2>Common Java Cookbook</h2>
                  <h4>Edition: 0.1-SNAPSHOT</h4>
               </div>
               <div style="clear:both;"></div>
               <div id="left-sidebar"></div>
            </div>
            <div class="navheader">
               <table width="100%" summary="Navigation header">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-6-SECT-3.html">6.3.&nbsp;Namespace-Aware Parsing</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">
                           												TOC
                                                                       </a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-6-SECT-3.3.html">6.3.3.&nbsp;Discussion</a></td>
                  </tr>
               </table>
            </div>
            <div class="sect2" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title"><a name="jakartackbk-CHP-6-SECT-3.2"></a>6.3.2.&nbsp;Solution
                        </h3>
                        <div class="section-icon"></div>
                     </div>
                  </div>
               </div>
               <p>Use Digester to parse<a class="indexterm" name="jakartackbk-CHP-6-ITERM-2703"></a> 
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2704"></a> 
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2705"></a> 
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2706"></a>
                  XML with multiple namespaces, using
                  <code class="literal">digester.setNamespaceAware(true)</code>, and supplying
                  two <code class="literal">RuleSet</code> objects to parse elements in each
                  namespace. Consider the following document, which contains elements
                  from two namespaces: <code class="filename">http://discursive.com/page</code>
                  and <code class="filename">http://discursive.com/person</code>:
               </p><a name="I_6_tt264"></a><pre class="programlisting">&lt;?xml version="1.0"?&gt;

&lt;pages xmlns="http://discursive.com/page"
       xmlns:person="http://discursive.com/person"&gt;
  &lt;page type="standard"&gt;
    &lt;person:person firstName="Al" lastName="Gore"&gt;
      &lt;person:role&gt;Co-author&lt;/person:role&gt; 
    &lt;/person:person&gt;
    &lt;person:person firstName="George" lastName="Bush"&gt;
      &lt;person:role&gt;Co-author&lt;/person:role&gt; 
    &lt;/person:person&gt;
  &lt;/page&gt;
&lt;/pages&gt;</pre><p>To parse this XML document with the Digester, you need to create two
                  separate sets of rules for each namespace, adding each
                  <code class="literal">RuleSet</code> object to <code class="literal">Digester</code> with
                  <code class="literal">addRuleSet( )</code>. A <code class="literal">RuleSet</code> adds
                  <code class="literal">Rule</code> objects to an instance of
                  <code class="literal">Digester</code>. By extending the
                  <code class="literal">RuleSetBase</code> class, and setting the
                  <code class="literal">namespaceURI</code> in the default constructor, the
                  following class, <code class="literal">PersonRuleSet</code>, defines rules to
                  parse the <code class="filename">http://discursive.com/person</code>
                  namespace:
               </p><a name="I_6_tt265"></a><pre class="programlisting">import org.apache.commons.digester.Digester;
import org.apache.commons.digester.RuleSetBase;

public class PersonRuleSet extends RuleSetBase {
    public PersonRuleSet( ) {
        this.namespaceURI = "http://discursive.com/person";
    }

    public void addRuleInstances(Digester digester) {
        digester.addObjectCreate("*/person", Person.class);
        digester.addSetNext("*/person", "addPerson");
        digester.addSetProperties("*/person");
        digester.addBeanPropertySetter("*/person/role", "role");
    }
}</pre><p>
                                 <code class="literal">PersonRuleSet</code> extends
                  <code class="literal">RuleSetBase</code>
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2707"></a>,
                  which is an implementation of the
                  <code class="literal">RuleSet</code>
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2708"></a>
                  interface. <code class="literal">RuleSetBase</code> adds support for namespaces
                  with a protected field <code class="literal">namespaceURI</code>. The
                  constructor of
                  <code class="literal">PersonRuleSet</code>
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2709"></a>
                  sets the <code class="literal">namespaceURI</code> field to
                  <code class="filename">http://discursive.com/person</code>, which tells the
                  <code class="literal">Digester</code> to apply these rules only to elements and
                  attributes in the <code class="filename">http://discursive.com/person</code>
                  namespace. <code class="literal">PageRuleSet</code> extends
                  <code class="literal">RuleSetBase</code> and provides a set of rules for the
                  <code class="filename">http://discursive.com/page</code> namespace:
               </p><a name="I_6_tt266"></a><pre class="programlisting">import org.apache.commons.digester.Digester;
import org.apache.commons.digester.RuleSetBase;

public class PageRuleSet extends RuleSetBase {
    public PageRuleSet( ) {
        this.namespaceURI = "http://discursive.com/page";
    }

    public void addRuleInstances(Digester digester) {
        digester.addObjectCreate("*/page", Page.class);
        digester.addSetNext("*/page", "addPage");
        digester.addSetProperties("*/page");
        digester.addBeanPropertySetter("*/page/summary", "summary");
    }
}</pre><p>Both <code class="literal">RuleSet</code> implementations instruct the Digester
                  to create a <code class="literal">Page</code> or a <code class="literal">Person</code>
                  object whenever either element is encountered. The
                  <code class="literal">PageRuleSet</code> instructs the Digester to create a
                  <code class="literal">Page</code> object when a <code class="literal">page</code> element
                  is encountered by using a wildcard
                  pattern&#8212;<code class="filename">*/page</code>. Both
                  <code class="literal">PageRuleSet</code> and <code class="literal">PersonRuleSet</code>
                  use <code class="literal">digester.addSetNext( )</code> to add the objects just
                  created to the next object in the <code class="literal">Stack</code>. In the
                  following code, an instance of <code class="literal">Pages</code> is pushed
                  onto the Digester <code class="literal">Stack</code>, and both
                  <code class="literal">RuleSet</code> implementations are added to a
                  <code class="literal">Digester</code> using <code class="literal">addRuleSet()</code>
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2710"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2711"></a>:
               </p><a name="I_6_tt267"></a><pre class="programlisting">import org.apache.commons.digester.Digester;
import org.apache.commons.digester.ObjectCreateRule;
import org.apache.commons.digester.RuleSetBase;
import org.apache.commons.digester.Rules;
import org.apache.commons.digester.SetNextRule;

Pages pages = new Pages( );
        
Digester digester = new Digester( );
digester.setNamespaceAware(true);
digester.addRuleSet( new PageRuleSet( ) );
digester.addRuleSet( new PersonRuleSet( ) );
        
digester.push(pages);

InputStream input = getClass( ).getResourceAsStream("./content.xml");
digester.parse(input);

Page page = (Page) pages.getPages( ).get(0);
System.out.println(page);</pre><p>Because the <code class="literal">PageRuleSet</code> adds each
                  <code class="literal">Page</code> object to the next object on the
                  <code class="literal">Stack</code>, the <code class="literal">Pages</code> object has an
                  <code class="literal">addPage( )</code> method that accepts a
                  <code class="literal">Page</code> object.
               </p>
            </div>
            <div class="navfooter">
               <hr>
               <table width="100%" summary="Navigation footer">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-6-SECT-3.html">Prev</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-6-SECT-3.3.html">Next</a></td>
                  </tr>
                  <tr>
                     <td width="40%" align="left" valign="top">6.3.&nbsp;Namespace-Aware Parsing&nbsp;</td>
                     <td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.sonatype.com/" title="Discursive: Discursive">Sponsored by Discursive
                                                                      </a></span></td>
                     <td width="40%" align="right" valign="top">&nbsp;6.3.3.&nbsp;Discussion</td>
                  </tr>
               </table>
            </div><br><center>
                             Copyright 2009. Discursive. All Rights Reserved.
                           
            </center><script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1693297-1");
pageTracker._initData();
pageTracker._setDomainName(".sonatype.com");
pageTracker._trackPageview();
</script><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
  _lf_cid = "LF_5208d25a";
_lf_remora();
</script></div>
      </div>
   </body>
</html>