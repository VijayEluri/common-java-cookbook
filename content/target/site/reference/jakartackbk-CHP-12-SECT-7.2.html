<html xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>12.7.2.&nbsp;Solution</title>
      <link rel="stylesheet" href="../css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="book.html" title="Jakarta Commons Cookbook">
      <link rel="up" href="jakartackbk-CHP-12-SECT-7.html" title="12.7.&nbsp;Searching for a Specific Term in a Document Index">
      <link rel="prev" href="jakartackbk-CHP-12-SECT-7.html" title="12.7.&nbsp;Searching for a Specific Term in a Document Index">
      <link rel="next" href="jakartackbk-CHP-12-SECT-7.3.html" title="12.7.3.&nbsp;Discussion">
   </head>
   <body>
      <div id="frame">
         <div id="forbg">
            <div id="user-header">
               <div id="logo"><a href="http://www.discursive.com" title="$"><img src="../images/discursive-logo.png" border="0"></a></div>
               <div id="right-header">
                  <h2>Common Java Cookbook</h2>
                  <h4>Edition: 0.1-SNAPSHOT</h4>
               </div>
               <div style="clear:both;"></div>
               <div id="left-sidebar"></div>
            </div>
            <div class="navheader">
               <table width="100%" summary="Navigation header">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-12-SECT-7.html">12.7.&nbsp;Searching for a Specific Term in a Document Index</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">
                           												TOC
                                                                       </a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-12-SECT-7.3.html">12.7.3.&nbsp;Discussion</a></td>
                  </tr>
               </table>
            </div>
            <div class="sect2" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title"><a name="jakartackbk-CHP-12-SECT-7.2"></a>12.7.2.&nbsp;Solution
                        </h3>
                        <div class="section-icon"></div>
                     </div>
                  </div>
               </div>
               <p>Use an
                  <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3437"></a>IndexSearcher
                  to search a Lucene index created with IndexWriter. This recipe
                  assumes that you have created a Lucene index using the techniques
                  shown in the previous recipe. The constructor of
                  <code class="literal">IndexSearcher</code> takes the name of a directory that
                  contains a Lucene index. A <code class="literal">Query</code> object can be
                  created by passing a <code class="literal">String</code> query, a default
                  search field, and an <code class="literal">Analyzer</code> to
                  <code class="literal">QueryParser.parse()</code>
                                 <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3438"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3439"></a>. The following example searches the
                  <code class="literal">Lucene</code> index created in the previous recipe for
                  all speeches containing the term
                  "Ophelia":
               </p><a name="I_12_tt501"></a><pre class="programlisting">import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.SimpleAnalyzer;
import org.apache.lucene.document.Document;
import org.apache.lucene.queryParser.QueryParser;
import org.apache.lucene.search.Hits;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.Query;
import org.apache.lucene.search.Searcher;

logger.info("Searching for Ophelia");
Searcher searcher = new IndexSearcher("index");
Analyzer analyzer = new SimpleAnalyzer( );
Query query = QueryParser.parse("Ophelia", "speech", analyzer);
Hits hits = searcher.search(query);
logger.info( "Searching Done, hit: " + hits.length( ) );

System.out.println( "Score | Play | Act | Scene | Speaker" );
        
for( int i = 0; i &lt; hits.length( ); i++ ) {
    Document doc = hits.doc(i);
    System.out.print( (int) (hits.score(i) * 100 ) );
    System.out.print( " | " + doc.get("play") );
    System.out.print( " | " + doc.get("act") );
    System.out.print( " | " + doc.get("scene") );
    System.out.print( " | " + doc.get("speaker") + "\n" );
}</pre><p>An <code class="literal">IndexSearcher</code> is created by passing in the name
                  of the directory containing the Lucene index to its constructor.
                  Next, an
                  <code class="literal">Analyzer</code>
                                 <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3440"></a>
                  is created that will analyze the query <code class="literal">String</code>.
               </p>
               <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title"><a name="jakartackbk-CHP-12-NOTE-75"></a>Warning
                  </h3>
                  <p>It is important at this stage to use the same
                     <code class="literal">Anaylzer</code> implementation that was used to create
                     the Lucene index to be searched, and, in this case, a
                     <code class="literal">SimpleAnalyzer</code> is used. If you use an
                     <code class="literal">Analyzer</code>, which discards the words
                     "to,"
                     "be,"
                     "or," and
                     "not," and then try to create a
                     <code class="literal">Query</code> for "to be or not to
                     be," you are not going to find the appropriate
                     speech in <span class="emphasis"><em>Hamlet</em></span> because the
                     <code class="literal">Analyzer</code> you used to parse your query dropped
                     every term.
                  </p>
               </div>
               <p>
                                 <code class="literal">QueryParser</code> parses the query string and creates a
                  <code class="literal">Query</code> object that will search the
                  "speech" field of each
                  <code class="literal">Document</code> in the index. The example then calls
                  <code class="literal">searcher.search( )</code> and iterates through
                  <code class="literal">Document</code> objects contained in an instance of
                  <code class="literal">Hits</code>. <code class="literal">Hits</code> contains a
                  <code class="literal">List</code> of <code class="literal">Document</code> objects and a
                  relevance score for each result; a relevance score is a number
                  between 1.00 and 0.00 that tells you how strongly a particular
                  <code class="literal">Document</code> matches a particular query. The more a
                  term occurs in a speech, the more relevant the speech is, and the
                  closer the relevance score is to 1. The previous example returns
                  every occurrence of the term
                  "Ophelia" in every Shakespeare
                  play, and, from the results, it is clear that Ophelia is a character
                  in <span class="emphasis"><em>Hamlet</em></span>. Every occurrence of Ophelia is listed
                  with the relevance, play, act, scene, and speaker:
               </p><a name="I_12_tt502"></a><pre class="programlisting">1   INFO [main] TermSearch     - Searching for Ophelia
321 INFO [main] TermSearch     - Searching Done, hit: 19

Score | Play   | Act     | Scene     | Speaker
100   | Hamlet | ACT IV  | SCENE V   | QUEEN GERTRUDE
100   | Hamlet | ACT IV  | SCENE V   | KING CLAUDIUS
81    | Hamlet | ACT IV  | SCENE V   | QUEEN GERTRUDE
81    | Hamlet | ACT V   | SCENE I   | HAMLET
58    | Hamlet | ACT I   | SCENE III | LORD POLONIUS
58    | Hamlet | ACT II  | SCENE I   | LORD POLONIUS
50    | Hamlet | ACT I   | SCENE III | LAERTES
33    | Hamlet | ACT V   | SCENE I   | HAMLET
25    | Hamlet | ACT III | SCENE I   | QUEEN GERTRUDE
24    | Hamlet | ACT III | SCENE I   | LORD POLONIUS
22    | Hamlet | ACT IV  | SCENE VII | LAERTES
21    | Hamlet | ACT III | SCENE I   | KING CLAUDIUS
17    | Hamlet | ACT IV  | SCENE V   | LAERTES
17    | Hamlet | ACT II  | SCENE II  | LORD POLONIUS
16    | Hamlet | ACT III | SCENE I   | LORD POLONIUS
14    | Hamlet | ACT II  | SCENE II  | LORD POLONIUS
13    | Hamlet | ACT I   | SCENE III | LORD POLONIUS
11    | Hamlet | ACT I   | SCENE III | LAERTES
11    | Hamlet | ACT III | SCENE I   | HAMLET</pre><p>A <code class="literal">Query</code> can also search for multiple terms in a
                  specific order because a Lucene index keeps track of the order
                  relationships between terms within a <code class="literal">Document</code>.
                  Searching for the famous "to be or not to
                  be" returns a single match from Act III, Scene I of
                  <span class="emphasis"><em>Hamlet</em></span>:
               </p><a name="I_12_tt503"></a><pre class="programlisting">0 [main] INFO TermSearch  - Searching for 'speech:"to be or not to be"'
354 [main] INFO TermSearch  - Searching Done, hit: 1

Score | Play   | Act     | Scene   | Speaker
100   | Hamlet | ACT III | SCENE I | HAMLET</pre><p>This search was only possible because the
                  <code class="literal">SimpleAnalyzer</code> is used during index creation and
                  query parsing. If a different <code class="literal">Analyzer</code> had been
                  used to create the index, the Lucene index would not be storing
                  information about such common words as
                  "to,"
                  "be,"
                  "or," and
                  "not." It is a common practice for
                  general search engines to discard very common terms such as
                  "the,"
                  "a,"
                  "an," or
                  "when." Discarding unimportant
                  terms can reduce the size of an index remarkably, but if you need to
                  search for "to be or not to be,"
                  you will need to preserve all terms.
               </p>
            </div>
            <div class="navfooter">
               <hr>
               <table width="100%" summary="Navigation footer">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-12-SECT-7.html">Prev</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-12-SECT-7.3.html">Next</a></td>
                  </tr>
                  <tr>
                     <td width="40%" align="left" valign="top">12.7.&nbsp;Searching for a Specific Term in a Document Index&nbsp;</td>
                     <td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.sonatype.com/" title="Discursive: Discursive">Sponsored by Discursive
                                                                      </a></span></td>
                     <td width="40%" align="right" valign="top">&nbsp;12.7.3.&nbsp;Discussion</td>
                  </tr>
               </table>
            </div><br><center>
                             Copyright 2009. Discursive. All Rights Reserved.
                           
            </center><script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1693297-1");
pageTracker._initData();
pageTracker._setDomainName(".sonatype.com");
pageTracker._trackPageview();
</script><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
  _lf_cid = "LF_5208d25a";
_lf_remora();
</script></div>
      </div>
   </body>
</html>