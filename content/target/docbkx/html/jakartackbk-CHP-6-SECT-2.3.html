<html xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>6.2.3.&nbsp;Discussion</title>
      <link rel="stylesheet" href="../css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="book.html" title="Jakarta Commons Cookbook">
      <link rel="up" href="jakartackbk-CHP-6-SECT-2.html" title="6.2.&nbsp;Turning XML Documents into Objects">
      <link rel="prev" href="jakartackbk-CHP-6-SECT-2.2.html" title="6.2.2.&nbsp;Solution">
      <link rel="next" href="jakartackbk-CHP-6-SECT-2.4.html" title="6.2.4.&nbsp;See Also">
   </head>
   <body>
      <div id="frame">
         <div id="forbg">
            <div id="user-header">
               <div id="logo"><a href="http://www.discursive.com" title="$"><img src="../images/discursive-logo.png" border="0"></a></div>
               <div id="right-header">
                  <h2>Common Java Cookbook</h2>
                  <h4>Edition: 0.1-SNAPSHOT</h4>
               </div>
               <div style="clear:both;"></div>
               <div id="left-sidebar"></div>
            </div>
            <div class="navheader">
               <table width="100%" summary="Navigation header">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-6-SECT-2.2.html">6.2.2.&nbsp;Solution</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">
                           												TOC
                                                                       </a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-6-SECT-2.4.html">6.2.4.&nbsp;See Also</a></td>
                  </tr>
               </table>
            </div>
            <div class="sect2" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title"><a name="jakartackbk-CHP-6-SECT-2.3"></a>6.2.3.&nbsp;Discussion
                        </h3>
                        <div class="section-icon"></div>
                     </div>
                  </div>
               </div>
               <p>Digester is simple, but there is one concept you need to understand:
                  Digester uses a <code class="literal">Stack</code> to relate objects to one
                  another. In the previous example, <code class="literal">set-next-rule</code>
                  tells the Digester to relate the top of the <code class="literal">Stack</code>
                  to the next-to-top of the <code class="literal">Stack</code>. Before the XML
                  document is parsed, a <code class="literal">List</code> is pushed onto the
                  <code class="literal">Stack</code>. Every time the Digester encounters a
                  <code class="literal">play</code> element, it will create an instance of
                  <code class="literal">Play</code>, push it onto the top of the
                  <code class="literal">Stack</code>, and call <code class="literal">add( )</code> with
                  <code class="literal">Play</code> as an argument on the object next to the top
                  of the stack. Since the <code class="literal">List</code> is next to the top of
                  the <code class="literal">Stack</code>, the Digester is simply adding the
                  <code class="literal">Play</code> to the <code class="literal">playList</code>. Within
                  the pattern element matching <code class="filename">plays/play</code>, there
                  is another pattern element matching
                  <code class="filename">characters/character</code>. When an element matching
                  <code class="filename">characters/character</code> is encountered, a
                  <code class="literal">Character</code> object is created, pushed onto the top
                  of the <code class="literal">Stack</code>, and the <code class="literal">addCharacter(
                     )</code> method is called on the next to top of the
                  <code class="literal">Stack</code>. When the <code class="literal">Character</code>
                  object is pushed onto the top of the <code class="literal">Stack</code>, the
                  <code class="literal">Play</code> object is next to the top of the
                  <code class="literal">Stack</code>; therefore, the call to
                  <code class="literal">addCharacter( )</code> adds a
                  <code class="literal">Character</code> to the <code class="literal">List</code> of
                  <code class="literal">Character</code> objects in the <code class="literal">Play</code>
                  object.
               </p>
               <p>Digester can be summed up as follows: define patterns to be matched
                  and a sequence of actions (rules) to take when these patterns are
                  encountered. Digester is essentially short-hand for your own SAX
                  parser, letting you accomplish the same task without having to deal
                  with the complexity of the SAX API. If you look at the source for the
                  <code class="literal">org.apache.commons.digester.Digester</code> class, you
                  see that it implements
                  <code class="literal">org.xml.sax.helpers.DefaultHandler</code> and that a call
                  to <code class="literal">parse( )</code> causes <code class="literal">Digester</code> to
                  register itself as a content handler on an instance of
                  <code class="literal">org.xml.sax.XMLReader</code>. Digester is simply a
                  lightweight shell around SAX, and, because of this, you can parse XML
                  just as fast with the Digester as with a system written to the SAX
                  API.
               </p>
               <p>Digester rule sets can be defined in an external XML document, or
                  programmatically in compiled Java code, but the general rules are the
                  same. The following code recreates the rule set defined in the
                  previous <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2697"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-6-ITERM-2698"></a>XML rule
                  set:
               </p><a name="I_6_tt263"></a><pre class="programlisting">import org.apache.commons.digester.BeanPropertySetterRule;
import org.apache.commons.digester.Digester;
import org.apache.commons.digester.ObjectCreateRule;
import org.apache.commons.digester.Rules;
import org.apache.commons.digester.SetNextRule;
import org.apache.commons.digester.SetPropertiesRule;

Digester digester = new Digester( );

Rules rules = digester.getRules( );

// Add Rules to parse a play element
rules.add( "plays/play", new ObjectCreateRule("xml.digester.Play"));
rules.add( "plays/play", new SetNextRule("add", "java.lang.Object") );
rules.add( "plays/play", new SetPropertiesRule( ) );
rules.add( "plays/play/name", new BeanPropertySetterRule("name") );
rules.add( "plays/play/summary", new BeanPropertySetterRule("summary") );
rules.add( "plays/play/author", new BeanPropertySetterRule("author") );

// Add Rules to parse a character element
rules.add( "plays/play/characters/character", new 
           ObjectCreateRule("xml.digester.Character"));
rules.add( "plays/play/characters/character", 
           new SetNextRule("addCharacter", "xml.digester.Character"));
rules.add( "plays/play/characters/character", new SetPropertiesRule( ) );
rules.add( "plays/play/characters/character/name", 
           new BeanPropertySetterRule("name") );
rules.add( "plays/play/characters/character/description", 
           new BeanPropertySetterRule("description") );</pre><p>While this is perfectly acceptable, think twice about defining
                  Digester rule sets programmatically. Defining rule sets in an XML
                  document provides a very clear separation between the framework used
                  to parse XML and the configuration of the Digester. When your rule
                  sets are separate from compiled code, it will be easier to update and
                  maintain logic involved in parsing; a change in the XML document
                  structure would not involve changing code that deals with parsing.
                  Instead, you would change the model and the mapping document.
                  Defining Digester rule sets in an XML document is a relatively new
                  Digester feature, and, because of this, you may find that some of the
                  more advanced capabilities of Digester demonstrated later in this
                  chapter are not available when defining rule sets in XML.
               </p>
            </div>
            <div class="navfooter">
               <hr>
               <table width="100%" summary="Navigation footer">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-6-SECT-2.2.html">Prev</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-6-SECT-2.4.html">Next</a></td>
                  </tr>
                  <tr>
                     <td width="40%" align="left" valign="top">6.2.2.&nbsp;Solution&nbsp;</td>
                     <td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.sonatype.com/" title="Discursive: Discursive">Sponsored by Discursive
                                                                      </a></span></td>
                     <td width="40%" align="right" valign="top">&nbsp;6.2.4.&nbsp;See Also</td>
                  </tr>
               </table>
            </div><br><center>
                             Copyright 2009. Discursive. All Rights Reserved.
                           
            </center><script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1693297-1");
pageTracker._initData();
pageTracker._setDomainName(".sonatype.com");
pageTracker._trackPageview();
</script><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
  _lf_cid = "LF_5208d25a";
_lf_remora();
</script></div>
      </div>
   </body>
</html>