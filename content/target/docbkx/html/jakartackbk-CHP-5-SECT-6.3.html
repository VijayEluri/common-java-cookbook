<html xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>5.6.3.&nbsp;Discussion</title>
      <link rel="stylesheet" href="../css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="book.html" title="Jakarta Commons Cookbook">
      <link rel="up" href="jakartackbk-CHP-5-SECT-6.html" title="5.6.&nbsp;Using a Bag">
      <link rel="prev" href="jakartackbk-CHP-5-SECT-6.2.html" title="5.6.2.&nbsp;Solution">
      <link rel="next" href="jakartackbk-CHP-5-SECT-6.4.html" title="5.6.4.&nbsp;See Also">
   </head>
   <body>
      <div id="frame">
         <div id="forbg">
            <div id="user-header">
               <div id="logo"><a href="http://www.discursive.com" title="$"><img src="../images/discursive-logo.png" border="0"></a></div>
               <div id="right-header">
                  <h2>Common Java Cookbook</h2>
                  <h4>Edition: 0.1-SNAPSHOT</h4>
               </div>
               <div style="clear:both;"></div>
               <div id="left-sidebar"></div>
            </div>
            <div class="navheader">
               <table width="100%" summary="Navigation header">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-5-SECT-6.2.html">5.6.2.&nbsp;Solution</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">
                           												TOC
                                                                       </a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-5-SECT-6.4.html">5.6.4.&nbsp;See Also</a></td>
                  </tr>
               </table>
            </div>
            <div class="sect2" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title"><a name="jakartackbk-CHP-5-SECT-6.3"></a>5.6.3.&nbsp;Discussion
                        </h3>
                        <div class="section-icon"></div>
                     </div>
                  </div>
               </div>
               <p>
                                 <code class="literal">Bag</code> has two implementations&#8212;<code class="literal">HashBag</code>
                  and <code class="literal">TreeBag</code>&#8212;which use a
                  <code class="literal">HashMap</code> and a <code class="literal">TreeMap</code> to store
                  the contents of a <code class="literal">Bag</code>. The same design
                  considerations apply to <code class="literal">Bag</code> that apply to
                  <code class="literal">Map</code>. Use <code class="literal">HashBag</code> for
                  performance and <code class="literal">TreeBag</code> when it is important to
                  maintain the order that each distinct object was added to a
                  <code class="literal">Bag</code>. A <code class="literal">TreeBag</code> returns unique
                  objects in the order they were introduced to the
                  <code class="literal">Bag</code>.
               </p>
               <p>To demonstrate the <code class="literal">Bag</code> object, a system to track
                  inventory is created using a <code class="literal">Bag</code> as an underlying
                  data structure. An inventory management system must find out how many
                  copies of a product are in stock, and a <code class="literal">Bag</code> is
                  appropriate because it allows you to keep track of the cardinality of
                  an object in a <code class="literal">Collection</code>. In <a href="jakartackbk-CHP-5-SECT-6.3.html#jakartackbk-CHP-5-EX-3" title="Example&nbsp;5-3.&nbsp;Using a Bag to track inventory">Example 5-3</a>, a record store tracks an inventory of albums,
                  consisting of 200 Radiohead albums, 100 Kraftwerk albums, 500 Charlie
                  Parker albums, and 900 ABBA albums.
               </p>
               <div class="example"><a name="jakartackbk-CHP-5-EX-3"></a><p class="title"><b>Example&nbsp;5-3.&nbsp;Using a Bag to track inventory</b></p>
                  <div class="example-contents"><pre class="programlisting">package com.discursive.jccook.collections.bag;

import java.text.NumberFormat;
import java.util.Collection;
import java.util.Iterator;
import java.util.Set;

import org.apache.commons.collections.Bag;
import org.apache.commons.collections.bag.HashBag;
import org.apache.commons.lang.StringUtils;

public class BagExample {
    Bag inventoryBag = new HashBag( );
    
    // Define 4 Albums
    Album album1 = new Album( "Radiohead", "OK Computer" );
    Album album2 = new Album( "Kraftwerk", "The Man-Machine" );
    Album album3 = new Album( "Charlie Parker", "Now's the Time" );
    Album album4 = new Album( "ABBA", "ABBA - Gold: Greatest Hits" );

    public static void main(String[] args) {
        BagExample example = new BagExample( );
        example.start( );
    }
    
    private void start( ) {
        // Read our inventory into a Bag
        populateInventory( );

        System.out.println( "Inventory before Transactions" );
        printAlbums( inventoryBag );
        printSeparator( );

        // A Customer wants to purchase 500 ABBA, 2 Radiohead, and 150 Parker
        Bag shoppingCart1 = new HashBag( );
        shoppingCart1.add( album4, 500 );
        shoppingCart1.add( album3, 150 );
        shoppingCart1.add( album1, 2 );
        checkout( shoppingCart1, "Customer 1" );
        
        // Another Customer wants to purchase 600 copies of ABBA 
        Bag shoppingCart2 = new HashBag( );
        shoppingCart2.add( album4, 600 );
        checkout( shoppingCart2, "Customer 2" );

        // Another Customer wants to purchase 3 copies of Kraftwerk
        Bag shoppingCart3 = new HashBag( );
        shoppingCart3.add( album2, 3 );
        checkout( shoppingCart3, "Customer 3" );

        System.out.println( "Inventory after Transactions" );
        printAlbums( inventoryBag );
        
    }
    
    private void populateInventory( ) {
        // Adds items to a Bag
        inventoryBag.add( album1, 200 );
        inventoryBag.add( album2, 100 );
        inventoryBag.add( album3, 500 );
        inventoryBag.add( album4, 900 );
    }
    
    private void printAlbums( Bag albumBag ) {
        Set albums = albumBag.uniqueSet( );
        Iterator albumIterator = albums.iterator( );
        while( albumIterator.hasNext( ) ) {
            Album album = (Album) albumIterator.next( );
            NumberFormat format = NumberFormat.getInstance( );
            format.setMinimumIntegerDigits( 3 );
            format.setMaximumFractionDigits( 0 );
            System.out.println( "\t" +  
                format.format( albumBag.getCount( album ) ) + 
                " - " + album.getBand( )  );
        }
    }
    
    private void checkout( Bag shoppingCart, String customer ) {
        // Check to see if we have the inventory to cover this purchase
        if( inventoryBag.containsAll( (Collection) shoppingCart ) ) {
            // Remove these items from our inventory
            inventoryBag.removeAll( (Collection) shoppingCart );
            System.out.println( customer + " purchased the following items:" );
            printAlbums( shoppingCart );
        } else {
            System.out.println( customer + ", I'm sorry " +
                                "but we are unable to fill your order." );
        }
        printSeparator( );
    }
    
    private void printSeparator( ) {
        System.out.println( StringUtils.repeat( "*", 65 ) );
    }
}</pre></div>
               </div><br class="example-break"><p>Albums are stored in the
                  <code class="literal">inventoryBag</code>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2472"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2473"></a>
                  variable, which is populated by a call to <code class="literal">populateInventory()</code>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2474"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2475"></a> method. The <code class="literal">printAlbums()</code>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2476"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2477"></a> method demonstrates how a
                  <code class="literal">Bag</code>'s iterator will iterate
                  through all of the distinct objects stored in a
                  <code class="literal">Bag</code>, printing out the count for each album by
                  calling <code class="literal">getCount( )</code> on the
                  <code class="literal">inventoryBag</code>. After populating and printing the
                  store's inventory, the<a class="indexterm" name="jakartackbk-CHP-5-ITERM-2478"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2479"></a> 
                                 <code class="literal">start( )</code> method models
                  the behavior of three customers. Each customer creates a
                  <code class="literal">Bag</code> instance, <code class="literal">shoppingBag</code>,
                  which holds the <code class="literal">Album</code> objects she wishes to
                  purchase.
               </p>
               <p>When a customer checks out of the store, the <code class="literal">containsAll()</code> method is called to make sure that the
                  <code class="literal">inventoryBag</code> contains adequate inventory to
                  fulfill a customer's order. If a customer attempts
                  to buy 40 copies of an album, we create a <code class="literal">Bag</code> with
                  40 instances of the <code class="literal">Album</code> object, and
                  <code class="literal">containsAll( )</code> will only return
                  <code class="literal">true</code> if the <code class="literal">inventoryBag</code>
                  contains at least 40 matching albums. Certain that the order can be
                  fulfilled, <code class="literal">removeAll( )</code> reduces the number of
                  albums in the <code class="literal">inventoryBag</code> by 40 and the
                  customer's transaction is considered complete.
               </p>
               <p>Each customer transaction is modeled by a <code class="literal">Bag</code> that
                  is subtracted from the <code class="literal">inventoryBag</code> using the
                  <code class="literal">removeAll( )</code> 
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2480"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-5-ITERM-2481"></a>method. <a href="jakartackbk-CHP-5-SECT-6.3.html#jakartackbk-CHP-5-EX-3" title="Example&nbsp;5-3.&nbsp;Using a Bag to track inventory">Example 5-3</a> prints
                  the inventory before and after the three customer transactions,
                  summarizing the result of each:
               </p><a name="I_5_tt218"></a><pre class="programlisting">Inventory before Transactions
    200 - Radiohead
    100 - Kraftwerk
    900 - ABBA
    500 - Charlie Parker
*****************************************************************
Customer 1 purchased the following items:
    002 - Radiohead
    500 - ABBA
    150 - Charlie Parker
*****************************************************************
Customer 2, I'm sorry but we are unable to fill your order.
*****************************************************************
Customer 3 purchased the following items:
    003 - Kraftwerk
*****************************************************************
Inventory after Transactions
    198 - Radiohead
    097 - Kraftwerk
    400 - ABBA
    350 - Charlie Parker</pre><p>Technically speaking, <code class="literal">Bag</code> is not a real
                  <code class="literal">Collection</code> implementation. The <code class="literal">removeAll(
                     )</code>, <code class="literal">containsAll( )</code>, <code class="literal">add()</code>, <code class="literal">remove( )</code>, and <code class="literal">retainAll(
                     )</code> methods do not strictly follow the contract defined by
                  the <code class="literal">Collection</code> interface. Adhering to a strict
                  interpretation of the <code class="literal">Collection</code> interface,
                  <code class="literal">removeAll( )</code> should remove all traces of an object
                  from a collection, and <code class="literal">containsAll( )</code> should not
                  pay attention to the cardinality of an object in a collection.
                  Calling <code class="literal">removeAll( )</code> with a single
                  <code class="literal">Album</code> object should clear the
                  <code class="literal">Bag</code> of any references to the specified
                  <code class="literal">Album</code> object, and <code class="literal">containsAll(
                     )</code> should return <code class="literal">true</code> if a collection
                  contains even one instance of a specified object. In
                  <code class="literal">Bag</code>, a call to <code class="literal">removeAll( )</code>
                  with three <code class="literal">Album</code> objects will remove only the
                  specified number of each <code class="literal">Album</code> object. In <a href="jakartackbk-CHP-5-SECT-6.3.html#jakartackbk-CHP-5-EX-3" title="Example&nbsp;5-3.&nbsp;Using a Bag to track inventory">Example 5-3</a>, the <code class="literal">checkout( )</code> method
                  uses <code class="literal">removeAll( )</code> to remove albums from the
                  inventory. A call to <code class="literal">containsAll( )</code> will only
                  return <code class="literal">true</code> if a <code class="literal">Bag</code> contains a
                  number greater than or equal to the cardinality specified in the
                  <code class="literal">Collection</code>. In <a href="jakartackbk-CHP-5-SECT-6.3.html#jakartackbk-CHP-5-EX-3" title="Example&nbsp;5-3.&nbsp;Using a Bag to track inventory">Example 5-3</a>, the
                  <code class="literal">checkout( )</code> method uses <code class="literal">containsAll(
                     )</code> to see if there is sufficient inventory to satisfy an
                  order. These violations should not keep you from using
                  <code class="literal">Bag</code>, but keep these exceptions to the collection
                  interface in mind if you are going to expose a <code class="literal">Bag</code>
                  as a collection in a widely used API.
               </p>
            </div>
            <div class="navfooter">
               <hr>
               <table width="100%" summary="Navigation footer">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-5-SECT-6.2.html">Prev</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-5-SECT-6.4.html">Next</a></td>
                  </tr>
                  <tr>
                     <td width="40%" align="left" valign="top">5.6.2.&nbsp;Solution&nbsp;</td>
                     <td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.sonatype.com/" title="Discursive: Discursive">Sponsored by Discursive
                                                                      </a></span></td>
                     <td width="40%" align="right" valign="top">&nbsp;5.6.4.&nbsp;See Also</td>
                  </tr>
               </table>
            </div><br><center>
                             Copyright 2009. Discursive. All Rights Reserved.
                           
            </center><script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1693297-1");
pageTracker._initData();
pageTracker._setDomainName(".sonatype.com");
pageTracker._trackPageview();
</script><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
  _lf_cid = "LF_5208d25a";
_lf_remora();
</script></div>
      </div>
   </body>
</html>