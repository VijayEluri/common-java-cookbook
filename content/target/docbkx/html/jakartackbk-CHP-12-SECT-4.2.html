<html xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>12.4.2.&nbsp;Solution</title>
      <link rel="stylesheet" href="../css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="book.html" title="Jakarta Commons Cookbook">
      <link rel="up" href="jakartackbk-CHP-12-SECT-4.html" title="12.4.&nbsp;Applying XPath Queries to Complex Object Graphs">
      <link rel="prev" href="jakartackbk-CHP-12-SECT-4.html" title="12.4.&nbsp;Applying XPath Queries to Complex Object Graphs">
      <link rel="next" href="jakartackbk-CHP-12-SECT-4.3.html" title="12.4.3.&nbsp;Discussion">
   </head>
   <body>
      <div id="frame">
         <div id="forbg">
            <div id="user-header">
               <div id="logo"><a href="http://www.discursive.com" title="$"><img src="../images/discursive-logo.png" border="0"></a></div>
               <div id="right-header">
                  <h2>Common Java Cookbook</h2>
                  <h4>Edition: 0.1-SNAPSHOT</h4>
               </div>
               <div style="clear:both;"></div>
               <div id="left-sidebar"></div>
            </div>
            <div class="navheader">
               <table width="100%" summary="Navigation header">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-12-SECT-4.html">12.4.&nbsp;Applying XPath Queries to Complex Object Graphs</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">
                           												TOC
                                                                       </a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-12-SECT-4.3.html">12.4.3.&nbsp;Discussion</a></td>
                  </tr>
               </table>
            </div>
            <div class="sect2" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title"><a name="jakartackbk-CHP-12-SECT-4.2"></a>12.4.2.&nbsp;Solution
                        </h3>
                        <div class="section-icon"></div>
                     </div>
                  </div>
               </div>
               <p>Use Jakarta Commons JXPath to select objects from a collection using
                  XPath queries. The following example uses Commons Digester to parse
                  an XML file into an object graph, and selects
                  <code class="literal">Planet</code> objects with a radius greater than 5000:
               </p><a name="I_12_tt488"></a><pre class="programlisting">import org.apache.commons.digester.Digester;
import org.apache.commons.digester.xmlrules.DigesterLoader;
import org.apache.commons.jxpath.JXPathContext;

List planets = new ArrayList( );

// Parse Planet XML into a List of Planet objects
InputStream input = getClass( ).getResourceAsStream("./planets.xml");
URL rules = getClass( ).getResource("./planet-digester-rules.xml");
Digester digester = DigesterLoader.createDigester(rules);
digester.push(planets);
digester.parse( input );

// Select all planets with a radius greater than 5000
System.out.println( "Planet Name where radius &gt; 5000");
JXPathContext context = JXPathContext.newContext( planets );
Iterator iterator = context.iterate(".[@radius &gt; 5000]/name");
while( iterator.hasNext( ) ) {
    Object o  = (Object) iterator.next( );
    System.out.println( "Object: " + o);
}</pre><p>The <code class="literal">Planet</code> objects are filtered and the names of
                  planets with sufficient radii are printed to the console:
               </p><a name="I_12_tt489"></a><pre class="programlisting">Planet Name where radius &gt; 5000
Object: Venus
Object: Saturn</pre><p>This object graph was created from an XML document that contains a
                  list of planets and their physical properties including mass, radius,
                  atmospheric composition, lunar population, and orbital distance and
                  period. Commons Digester (from <a href="jakartackbk-CHP-6.html" title="Chapter&nbsp;6.&nbsp;XML">Chapter 6</a>) is
                  used to parse this XML document to a list of
                  <code class="literal">Planet</code> objects. The following XML document,
                  <code class="filename">planets.xml</code>, was parsed in the previous example:
               </p><a name="I_12_tt490"></a><pre class="programlisting">&lt;planets&gt;
    &lt;planet name="Venus" mass="4.869e+24" radius="6051.8"&gt;
        &lt;orbit distance="108200000" period="224.701"/&gt;
        &lt;atmosphere meanTemp="482" pressure="92"&gt;
            &lt;component symbol="CO2" percentage="96"/&gt;
            &lt;component symbol="N" percentage="3"/&gt;
            &lt;component symbol="Other" percentage="1"/&gt;
        &lt;/atmosphere&gt;
    &lt;/planet&gt;
    &lt;planet name="Mars" mass="6.421e+23" radius="3397.2"&gt;
        &lt;orbit distance="227940000" period="686.98"/&gt;
        &lt;atmosphere meanTemp="-63" pressure="0.007"&gt;
            &lt;component symbol="CO2" percentage="95.32"/&gt;
            &lt;component symbol="N2" percentage="2.7"/&gt;
            &lt;component symbol="Ar" percentage="1.6"/&gt;
        &lt;/atmosphere&gt;
        &lt;moon&gt;Phobos&lt;/moon&gt;
        &lt;moon&gt;Deimos&lt;/moon&gt;
    &lt;/planet&gt;
    &lt;planet name="Saturn" mass="5.688e+26" radius="60268"&gt;
        &lt;orbit distance="1429400000" period="29.458"/&gt;
        &lt;atmosphere meanTemp="-125" pressure="1.4"&gt;
            &lt;component symbol="H" percentage="97"/&gt;
            &lt;component symbol="He" percentage="3"/&gt;
        &lt;/atmosphere&gt;
        &lt;moon&gt;Pan&lt;/moon&gt;
        &lt;moon&gt;Atlas&lt;/moon&gt;
        &lt;moon&gt;Prometheus&lt;/moon&gt;
        &lt;moon&gt;Pandora&lt;/moon&gt;
    &lt;moon&gt;Epimetheus&lt;/moon&gt;
    &lt;moon&gt;Janus&lt;/moon&gt;
    &lt;moon&gt;Mimas&lt;/moon&gt;
  &lt;/planet&gt;
&lt;/planets&gt;</pre><p>To parse this XML document, the following Digester rules are passed
                  to <code class="literal">DigesterLoader.createDigester()</code>
                                 <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3398"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3399"></a>. This digester rule-set creates a
                  <code class="literal">Planet</code>, <code class="literal">Orbit</code>, and
                  <code class="literal">Atmosphere</code> object for each planet.
                  <code class="literal">Moon</code> objects are created and added to
                  <code class="literal">Planet</code> objects using the <code class="literal">addMoon(
                     )</code> method on <code class="literal">Planet</code>. Individual compounds
                  in an atmosphere are added to an
                  <code class="literal">Atmosphere</code>'s
                  <code class="literal">component</code> 
                                 <code class="literal">Map</code> using
                  <code class="literal">addComponent( )</code>
                                 <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3400"></a>
                                 <a class="indexterm" name="jakartackbk-CHP-12-ITERM-3401"></a>. The following XML document contains the
                  contents of the <code class="filename">planet-digester-rules.xml</code> file
                  used in the previous example:
               </p><a name="I_12_tt491"></a><pre class="programlisting">&lt;digester-rules&gt;
    &lt;pattern value="planets/planet"&gt;
        &lt;object-create-rule classname="Planet"/&gt;
        &lt;set-properties-rule/&gt;
        &lt;pattern value="orbit"&gt;
            &lt;object-create-rule classname=" Orbit"/&gt;
            &lt;set-properties-rule/&gt;
            &lt;set-next-rule methodname="setOrbit" paramtype=" Orbit"/&gt;
        &lt;/pattern&gt;
        &lt;pattern value="atmosphere"&gt;
            &lt;object-create-rule classname="Atmosphere"/&gt;
            &lt;set-properties-rule/&gt;
            &lt;pattern value="component"&gt;
                &lt;call-method-rule methodname="addComponent" paramcount="2"
                              paramtypes="java.lang.String,java.lang.Double"/&gt;
                &lt;call-param-rule attrname="symbol" paramnumber="0"/&gt;    
                &lt;call-param-rule attrname="percentage" paramnumber="1"/&gt;
            &lt;/pattern&gt;
            &lt;set-next-rule methodname="setAtmosphere"         
                           paramtype=" Atmosphere"/&gt;
        &lt;/pattern&gt;
        &lt;call-method-rule pattern="moon" methodname="addMoon" 
                          paramtypes="java.lang.String" paramcount="0"/&gt;    
        &lt;set-next-rule methodname="add" paramtype="java.lang.Object"/&gt;
    &lt;/pattern&gt;
&lt;/digester-rules&gt;</pre></div>
            <div class="navfooter">
               <hr>
               <table width="100%" summary="Navigation footer">
                  <tr>
                     <td width="40%" align="left"><a accesskey="p" href="jakartackbk-CHP-12-SECT-4.html">Prev</a>&nbsp;
                     </td>
                     <td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td>
                     <td width="40%" align="right">&nbsp;<a accesskey="n" href="jakartackbk-CHP-12-SECT-4.3.html">Next</a></td>
                  </tr>
                  <tr>
                     <td width="40%" align="left" valign="top">12.4.&nbsp;Applying XPath Queries to Complex Object Graphs&nbsp;</td>
                     <td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.sonatype.com/" title="Discursive: Discursive">Sponsored by Discursive
                                                                      </a></span></td>
                     <td width="40%" align="right" valign="top">&nbsp;12.4.3.&nbsp;Discussion</td>
                  </tr>
               </table>
            </div><br><center>
                             Copyright 2009. Discursive. All Rights Reserved.
                           
            </center><script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1693297-1");
pageTracker._initData();
pageTracker._setDomainName(".sonatype.com");
pageTracker._trackPageview();
</script><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
  _lf_cid = "LF_5208d25a";
_lf_remora();
</script></div>
      </div>
   </body>
</html>